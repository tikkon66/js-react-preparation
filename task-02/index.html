<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .table {
        display: grid;
        grid-template-columns: repeat(5, 1fr);

    }

    .table>div,
    .statistic>div {
        padding: 20px;
        border: solid, 1px, #333;
        text-align: center;
    }

    .table-head {
        background-color: tomato;
    }

    .options {
        display: flex;
        justify-content: space-between;
    }

    .control,
    .statistic,
    .search {
        display: flex;
    }

    .button {
        padding: 20px;
        background-color: aqua;
        text-align: center;
        color: #333;
        transition: all, 100ms;
        border: solid, 1px, #333;
        cursor: pointer;
    }

    .button:active {
        background-color: yellowgreen;
    }
</style>

<body>
    <div class="search">
        <input id="searchText" type="text" placeholder="title of task">
        <div onclick="searchTasks()" class="button" style="padding: 5px;">search</div>
    </div>

    <div>
        <div class="table">
            <div class="table-head">ID</div>
            <div class="table-head">TITLE</div>
            <div class="table-head">COMPLETED</div>
            <div class="table-head">PRIORITY</div>
            <div class="table-head">CREATED AT</div>

        </div>

        <div class="table" id="table">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <div class="options">
        <div class="statistic">
            <div class="button" onclick="getTasksStats()">statistic</div>
            <div class="statistic-table">all:</div>
            <div class="statistic-table">completed:</div>
            <div class="statistic-table">left:</div>
        </div>

        <div class="control">
            <div class="button" onclick="addTask()">add task</div>
            <div class="button" onclick="removeTask()">remove task</div>
            <div class="button" onclick="toggleTask()">change completed status</div>
            <div class="button" onclick="filterTasks('all')">view all</div>
            <div class="button" onclick="filterTasks('completed')">view completed</div>
            <div class="button" onclick="filterTasks('pending')">view pending</div>
            <div class="button" onclick="getTasksByPriority()">more priority</div>
        </div>
    </div>


</body>
<script>
    //     {
    //   id: 1,
    //   title: "Изучить JavaScript",
    //   completed: false,
    //   priority: "high",// low, medium, high
    //   createdAt: "2024-01-15"
    // }
    // 2. **Функции для реализации:**
    //     ## `addTask(title, priority)` - добавить задачу
    //     ## `removeTask(id)` - удалить задачу
    //     ## `toggleTask(id)` - изменить статус выполнения
    //     ## `filterTasks(status)` - фильтрация по статусу ('all', 'completed', 'pending')
    //     ## `getTasksByPriority(priority)` - задачи по приоритету
    //     ## `getTasksStats()` - статистика (всего, выполнено, осталось)
    // 3. **Дополнительно:**
    //     ## Поиск задач по тексту `searchTasks(query)`

    // первозданный обьект
    let tasks = JSON.parse(sessionStorage.getItem('tasks')) || [
        {
            id: 1,
            title: "Изучить JavaScript",
            completed: false,
            priority: "high",// low, medium, high
            createdAt: "2024-01-15"
        }
    ];

    let id_task = 2;

    // отслеживание даты
    const today = new Date()
    const day = String(today.getDate()).padStart(2, "0")
    const month = String(today.getMonth() + 1).padStart(2, "0");
    const year = today.getFullYear()

    // сохранить массив обьектов
    function save() {
        sessionStorage.setItem('tasks', JSON.stringify(tasks))
        sessionStorage.setItem('id_tasks', id_task)
    }

    function clearTable() {
        table.innerHTML = ""
    }

    // добавить обьект
    function addTask() {
        let title = prompt("title")
        let priority = prompt("priority")

        if (title == null || priority == null) {
            alert("date don't written")
        }
        else {
            tasks.push({
                id: id_task,
                title: title,
                completed: false,
                priority: priority,
                createdAt: `${year}-${month}-${day}`
            })

            id_task += 1;
            save()
        }

    }

    // нахождение по айди
    function findToId(id) {
        let ok = true;
        let i = -1;
        while (ok && i < tasks.length) {
            i++;
            if (tasks[i].id == id) ok = false;
        }
        if (ok) return false
        else return i
    }

    // удалить обьект
    function removeTask() {
        let id = Number(prompt("the id of the object to be changed"))
        let i = findToId(id)

        if (i === false) {
            console.log("неправильное id")
        }
        else {
            tasks.splice(i, 1);
            save()
        }
    }

    // изменение статуса
    function toggleTask() {
        let id = Number(prompt("id of object which want to change"))
        let i = findToId(id)

        if (i === false) {
            console.log("неправильное id")
        }
        else {
            tasks[i].completed = !tasks[i].completed
            save()
        }
    }

    const table = document.getElementById("table")

    // добавление в таблицу
    function addInTable(object) {
        table.innerHTML = ""
        table.innerHTML += `
                    <div>${object.id}</div>
                    <div>${object.title}</div>
                    <div>${object.completed}</div>
                    <div>${object.priority}</div>
                    <div>${object.createdAt}</div>
                `
    }

    // сортировка по статусу
    function filterTasks(status) {
        clearTable()

        if (status == "all") {
            for (let i = 0; i < tasks.length; i++) {
                addInTable(tasks[i])
            }

        }
        else if (status == "completed") {
            for (let i = 0; i < tasks.length; i++) {
                if (tasks[i].completed == true) {
                    addInTable(tasks[i])
                }

            }
        }
        else if (status == "pending") {
            for (let i = 0; i < tasks.length; i++) {
                if (tasks[i].completed == false) {
                    addInTable(tasks[i])
                }

            }
        }
    }

    // сортировка по приоритету
    function getTasksByPriority() {
        clearTable()

        for (let i = 0; i < tasks.length; i++) {
            if (tasks[i].priority == "high") {
                addInTable(tasks[i])
            }
        }
        for (let i = 0; i < tasks.length; i++) {
            if (tasks[i].priority == "medium") {
                addInTable(tasks[i])
            }
        }
        for (let i = 0; i < tasks.length; i++) {
            if (tasks[i].priority == "low") {
                addInTable(tasks[i])
            }
        }
    }

    let statisticTable = document.getElementsByClassName("statistic-table")

    function getTasksStats() {
        let all
        let completed = 0;
        let left = 0;


        for (let i = 0; i < tasks.length; i++) {
            if (tasks[i].completed == true) {
                completed++
            }
            else {
                left++
            }

        }


        all = tasks.length;
        statisticTable[0].textContent = "all: " + all
        statisticTable[1].textContent = "completed: " + completed
        statisticTable[2].textContent = "left: " + left
    }


    function searchTasks() {
        let searchText = document.getElementById("searchText").value.replace(/ /g, "").toLowerCase()

        for (let i = 0; i < tasks.length; i++) {
            if (tasks[i].title.slice(0, searchText.length).toLowerCase() == searchText) {
                addInTable(tasks[i])
            }
        }

    }

</script>

</html>